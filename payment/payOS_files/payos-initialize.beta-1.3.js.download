!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("PayOSCheckout",[],t):"object"==typeof exports?exports.PayOSCheckout=t():e.PayOSCheckout=t()}(self,(()=>(()=>{"use strict";var e={d:(t,o)=>{for(var s in o)e.o(o,s)&&!e.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:o[s]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{usePayOS:()=>s});class o{constructor(e){this.RETURN_URL=e.RETURN_URL,this.ELEMENT_ID=e.ELEMENT_ID,this.CHECKOUT_URL=e.CHECKOUT_URL,this.embedded=e.embedded||!1,this.onSuccess=e.onSuccess||function(){},this.onExit=e.onExit||function(){},this.onCancel=e.onCancel||function(){},this.PAYOS_CONSTANT={RESPONSE_IFRAME_TYPE:{STATUS:"status",ERROR:"error",PAYMENT_RESPONSE:"payment_response"},PAYMENT_STATUS:{PENDING:"PENDING",PAID:"PAID",PROCESSING:"PROCESSING",CANCELLED:"CANCELLED",DELETED:"DELETED"},ORIGIN:["https://dev.pay.payos.vn","https://pay.payos.vn"]},this.receiveMessage=e=>{if(this.PAYOS_CONSTANT.ORIGIN.includes(e.origin)){if(!function(e){try{JSON.parse(e)}catch(e){return!1}return!0}(e.data))return;let t=JSON.parse(e.data),o=JSON.parse(e.data);if(function(e){const t=e.match(/^https:\/\/(?:dev\.|)pay\.payos\.vn\/web\/([a-fA-F0-9]{32})$/);return t&&t.length>1?t[1]:""}(this.CHECKOUT_URL)!==o.data?.id)return;if([this.PAYOS_CONSTANT.RESPONSE_IFRAME_TYPE.STATUS,this.PAYOS_CONSTANT.RESPONSE_IFRAME_TYPE.ERROR].includes(t?.type))this.closeIframe(),this.onExit(t.data);else if(t?.type===this.PAYOS_CONSTANT.RESPONSE_IFRAME_TYPE.PAYMENT_RESPONSE)if(t?.data.status===this.PAYOS_CONSTANT.PAYMENT_STATUS.CANCELLED){this.closeIframe();const e="string"==typeof t?.data?JSON.parse(t.data):t.data;this.onCancel(e)}else{this.closeIframe();const e="string"==typeof t?.data?JSON.parse(t.data):t.data;this.onSuccess(e)}}}}openIframe(e){window.addEventListener("message",this.receiveMessage,!1);const t=document.getElementById(this.ELEMENT_ID);if(!t)return void console.error(`Element ID:${this.ELEMENT_ID} not exist`);const o=document.createElement("iframe");if(o.allow="clipboard-write",o.width="100%",this.embedded||e)return o.src=`${this.CHECKOUT_URL.replace("/web/","/embedded/")}?redirect_uri=${this.RETURN_URL}`,o.height="100%",void t.appendChild(o);o.src=`${this.CHECKOUT_URL}?iframe=true&redirect_uri=${this.RETURN_URL}`,o.height=window.innerHeight.toString(),o.allowFullscreen=!0,o.style.zIndex="1000",o.style.position="fixed",t.appendChild(o)}closeIframe(){const e=document.getElementById(this.ELEMENT_ID);if(!e)return void console.error(`Element ID:${this.ELEMENT_ID} not exist`);const t=e.querySelector("iframe");if(t)return e.removeChild(t),void window.removeEventListener("message",this.receiveMessage,!1);console.error("No iframe to remove")}}function s(e){const t=new o(e);return{open:(e=!1)=>t.openIframe.call(t,e),exit:t.closeIframe.bind(t)}}return t})()));